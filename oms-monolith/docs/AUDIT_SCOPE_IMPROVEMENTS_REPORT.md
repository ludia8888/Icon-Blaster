# Audit & Scope ê°œì„ ì‚¬í•­ êµ¬í˜„ ë³´ê³ ì„œ

## êµ¬í˜„ ì¼ì‹œ
2025-06-26

## Executive Summary

ì¶”ì²œ í•­ëª© 1(Audit ë¡œê·¸ ì‹ë³„ì êµ¬ì¡°)ê³¼ ì¶”ì²œ í•­ëª© 2(Scope-Role ê´€ê³„ ì •ë¦¬)ë¥¼ ë°˜ì˜í•˜ì—¬ OMSì˜ ê°ì‚¬ ë° ê¶Œí•œ ì‹œìŠ¤í…œì„ ëŒ€í­ ê°œì„ í–ˆìŠµë‹ˆë‹¤.

---

## ì¶”ì²œ í•­ëª© 1: Audit ë¡œê·¸ ì‹ë³„ì êµ¬ì¡° ê°œì„ 

### êµ¬í˜„ëœ êµ¬ì¡°í™”ëœ ID íŒ¨í„´
```
audit-{service}:{resource_type}:{resource_id}:{action}:{timestamp}:{uuid}
```

### ì‹¤ì œ ì˜ˆì‹œ
```
audit-oms:object_type:user:create:20250626T100000Z:550e8400-e29b-41d4-a716-446655440000
```

### êµ¬ì„± ìš”ì†Œë³„ ì„¤ëª…

| êµ¬ì„± ìš”ì†Œ | ì„¤ëª… | ì˜ˆì‹œ | ìš©ë„ |
|-----------|------|------|------|
| `audit` | ê³ ì • ì ‘ë‘ì‚¬ | `audit` | ë¡œê·¸ íƒ€ì… ì‹ë³„ |
| `service` | ì„œë¹„ìŠ¤ ì´ë¦„ | `oms` | ë©€í‹° ì„œë¹„ìŠ¤ í™˜ê²½ì—ì„œ êµ¬ë¶„ |
| `resource_type` | ë¦¬ì†ŒìŠ¤ íƒ€ì… | `object_type` | ë¦¬ì†ŒìŠ¤ë³„ í•„í„°ë§ |
| `resource_id` | ë¦¬ì†ŒìŠ¤ ID | `user` (ì •ë¦¬ëœ í˜•íƒœ) | íŠ¹ì • ë¦¬ì†ŒìŠ¤ ì¶”ì  |
| `action` | ìˆ˜í–‰ëœ ì•¡ì…˜ | `create` | ì•¡ì…˜ë³„ ë¶„ì„ |
| `timestamp` | íƒ€ì„ìŠ¤íƒ¬í”„ | `20250626T100000Z` | ì‹œê°„ìˆœ ì •ë ¬, ì‹œê°„ëŒ€ë³„ ë¶„ì„ |
| `uuid` | ê³ ìœ  ì‹ë³„ì | `550e8400...` | ì™„ì „í•œ ê³ ìœ ì„± ë³´ì¥ |

### ê²€ìƒ‰ ë° ë¶„ì„ í™œìš©

#### 1. íŒ¨í„´ ê¸°ë°˜ ê²€ìƒ‰
```python
# ëª¨ë“  ObjectType ì‘ì—…
pattern = "audit-oms:object_type:*:*:*:*"

# ëª¨ë“  ìƒì„± ì‘ì—…
pattern = "audit-oms:*:*:create:*:*"

# íŠ¹ì • ë‚ ì§œì˜ ëª¨ë“  ì‘ì—…
pattern = "audit-oms:*:*:*:20250626*:*"

# ê³ ìœ„í—˜ ì‘ì—… (ì‚­ì œ)
pattern = "audit-oms:*:*:delete:*:*"
```

#### 2. ì´ìƒ íƒì§€ í‚¤ ìƒì„±
ê° audit IDëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì´ìƒ íƒì§€ í‚¤ë¥¼ ìë™ ìƒì„±í•©ë‹ˆë‹¤:
- `object_type:create` (ë¦¬ì†ŒìŠ¤-ì•¡ì…˜ ì¡°í•©)
- `object_type:*` (ë¦¬ì†ŒìŠ¤ë³„ ë¹ˆë„)
- `*:create` (ì•¡ì…˜ë³„ ë¹ˆë„)
- `object_type:create:20250626T10` (ì‹œê°„ëŒ€ë³„ íŒ¨í„´)
- `object_type:user:create` (íŠ¹ì • ë¦¬ì†ŒìŠ¤ íŒ¨í„´)

#### 3. ì‹œê³„ì—´ ë¶„ì„
íƒ€ì„ìŠ¤íƒ¬í”„ í˜•ì‹(`YYYYMMDDTHHMMSSZ`)ìœ¼ë¡œ ë‹¤ìŒ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤:
- ì‹œê°„ëŒ€ë³„ í™œë™ íŒ¨í„´
- ì¼ì¼/ì£¼ë³„/ì›”ë³„ íŠ¸ë Œë“œ
- í”¼í¬ ì‹œê°„ ì‹ë³„
- ë¹„ì •ìƒì ì¸ ì‹œê°„ëŒ€ í™œë™ íƒì§€

### êµ¬í˜„ëœ ì£¼ìš” ê¸°ëŠ¥

#### AuditIDGenerator í´ë˜ìŠ¤
- **êµ¬ì¡°í™”ëœ ID ìƒì„±**: ì¼ê´€ëœ í˜•ì‹ìœ¼ë¡œ ID ìƒì„±
- **íŠ¹ìˆ˜ ë¬¸ì ì²˜ë¦¬**: ë¦¬ì†ŒìŠ¤ IDì˜ íŠ¹ìˆ˜ë¬¸ì ì •ë¦¬
- **ê¸¸ì´ ì œí•œ**: ê¸´ IDë¥¼ 50ìë¡œ ì œí•œí•˜ê³  "..." ì¶”ê°€
- **ID íŒŒì‹±**: êµ¬ì¡°í™”ëœ IDë¥¼ ë‹¤ì‹œ êµ¬ì„± ìš”ì†Œë¡œ ë¶„í•´
- **ê²€ìƒ‰ íŒ¨í„´ ìƒì„±**: ë¡œê·¸ ì‹œìŠ¤í…œìš© ì™€ì¼ë“œì¹´ë“œ íŒ¨í„´

#### AuditIDPatterns í´ë˜ìŠ¤
- **ì¼ë°˜ì ì¸ íŒ¨í„´**: ìì£¼ ì‚¬ìš©ë˜ëŠ” ê²€ìƒ‰ íŒ¨í„´ ì œê³µ
- **ê³ ìœ„í—˜ ì‘ì—… íŒ¨í„´**: ì‚­ì œ, ë³µì›, ìŠ¹ì¸ ë“±
- **ê´€ë¦¬ì ì‘ì—… íŒ¨í„´**: ì‹œìŠ¤í…œ ìˆ˜ì¤€ ì‘ì—…

---

## ì¶”ì²œ í•­ëª© 2: Scope-Role ê´€ê³„ ì •ë¦¬

### ì²´ê³„ì ì¸ Scope-Role ë§¤í•‘ í…Œì´ë¸”

| Role | Scope Prefix | í•„ìˆ˜ Scope | ì„ íƒ Scope | ì ‘ê·¼ ìˆ˜ì¤€ |
|------|-------------|-------------|------------|----------|
| **admin** | `api:*:admin`, `api:system:*` | `api:system:admin` | ì—†ìŒ | ì „ì²´ ì‹œìŠ¤í…œ ì ‘ê·¼ |
| **developer** | `api:*:write` | `api:ontologies:read`, `api:schemas:read`, `api:branches:read` | `api:ontologies:write`, `api:schemas:write`, `api:branches:write` | ê°œë°œ ì‘ì—… |
| **reviewer** | `api:*:read`, `api:proposals:approve` | `api:proposals:read`, `api:proposals:approve` | `api:ontologies:read`, `api:audit:read` | ê²€í†  ë° ìŠ¹ì¸ |
| **viewer** | `api:*:read` | ì—†ìŒ | ëª¨ë“  `:read` scope | ì½ê¸° ì „ìš© |
| **service_account** | `api:service:*`, `api:webhook:*` | `api:service:account` | `api:webhook:execute` | ì„œë¹„ìŠ¤ í†µí•© |

### Scope ê³„ì¸µ êµ¬ì¡°

```
api:system:admin (ìµœìƒìœ„)
â”œâ”€â”€ api:ontologies:admin
â”‚   â”œâ”€â”€ api:ontologies:write
â”‚   â”‚   â””â”€â”€ api:ontologies:read
â”‚   â””â”€â”€ api:schemas:write
â”‚       â””â”€â”€ api:schemas:read
â”œâ”€â”€ api:proposals:approve
â”‚   â””â”€â”€ api:proposals:read
â””â”€â”€ api:audit:read

ë…ë¦½ì  ê³„ì¸µ:
â”œâ”€â”€ api:branches:write
â”‚   â””â”€â”€ api:branches:read
â”œâ”€â”€ api:webhook:execute
â””â”€â”€ api:service:account
```

### ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

#### 1. Admin User JWT
```json
{
  "sub": "admin-001",
  "iss": "iam.company",
  "aud": "oms", 
  "scope": "api:system:admin",
  "roles": ["admin"],
  "exp": 1640995200
}
```

#### 2. Developer User JWT
```json
{
  "sub": "dev-001",
  "iss": "iam.company", 
  "aud": "oms",
  "scope": "api:ontologies:write api:schemas:read api:branches:write api:proposals:write",
  "roles": ["developer"],
  "exp": 1640995200
}
```

#### 3. Reviewer User JWT
```json
{
  "sub": "reviewer-001",
  "iss": "iam.company",
  "aud": "oms", 
  "scope": "api:ontologies:read api:proposals:approve api:audit:read",
  "roles": ["reviewer"],
  "exp": 1640995200
}
```

### êµ¬í˜„ëœ ê²€ì¦ ë¡œì§

#### ScopeRoleMatrix í´ë˜ìŠ¤
- **ì—­í•  ìë™ í• ë‹¹**: Scope ì¡°í•©ì— ë”°ë¥¸ ìë™ ì—­í•  ê²°ì •
- **ì—­í•  ê²€ì¦**: í• ë‹¹ëœ ì—­í• ì´ ë³´ìœ  scopeì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
- **ê³„ì¸µ êµ¬ì¡° ì§€ì›**: ìƒìœ„ scopeê°€ í•˜ìœ„ scopeë¥¼ í¬í•¨í•˜ëŠ” ë¡œì§
- **íŒ¨í„´ ë§¤ì¹­**: ì •ê·œì‹ ê¸°ë°˜ ë™ì  scope ë§¤ì¹­

#### ê²€ì¦ ì˜ˆì‹œ
```python
# ì˜¬ë°”ë¥¸ ì—­í•  í• ë‹¹
is_valid, issues = ScopeRoleMatrix.validate_role_scope_assignment(
    Role.REVIEWER,
    ["api:proposals:read", "api:proposals:approve"]
)
# is_valid = True, issues = []

# ì˜ëª»ëœ ì—­í•  í• ë‹¹
is_valid, issues = ScopeRoleMatrix.validate_role_scope_assignment(
    Role.REVIEWER,
    ["api:ontologies:read"]  # í•„ìˆ˜ scope ëˆ„ë½
)
# is_valid = False, issues = ["Missing required scopes..."]
```

---

## 3. í†µí•© íš¨ê³¼

### ê°ì‚¬ ì¶”ì  ê°œì„ 
1. **ì •í™•í•œ ë¡œê·¸ ì‹ë³„**: êµ¬ì¡°í™”ëœ IDë¡œ ë¹ ë¥¸ ê²€ìƒ‰
2. **íŒ¨í„´ ë¶„ì„**: ì‚¬ìš©ìë³„, ë¦¬ì†ŒìŠ¤ë³„, ì‹œê°„ë³„ íŒ¨í„´ ë¶„ì„
3. **ì´ìƒ íƒì§€**: ìë™í™”ëœ ì´ìƒ í–‰ë™ íƒì§€

### ê¶Œí•œ ê´€ë¦¬ ê°œì„ 
1. **ëª…í™•í•œ ë§¤í•‘**: Scopeì™€ Role ê°„ ëª…í™•í•œ ê´€ê³„
2. **ìë™ ê²€ì¦**: ê¶Œí•œ í• ë‹¹ì˜ ì¼ê´€ì„± ìë™ í™•ì¸
3. **ê³„ì¸µì  ê¶Œí•œ**: ìƒì† ê´€ê³„ë¥¼ í†µí•œ íš¨ìœ¨ì  ê¶Œí•œ ê´€ë¦¬

### ìš´ì˜ íš¨ìœ¨ì„±
1. **ë¹ ë¥¸ ë¬¸ì œ í•´ê²°**: êµ¬ì¡°í™”ëœ IDë¡œ ì‹ ì†í•œ ë¡œê·¸ ê²€ìƒ‰
2. **ì»´í”Œë¼ì´ì–¸ìŠ¤**: ì²´ê³„ì ì¸ ê°ì‚¬ ì¶”ì 
3. **í™•ì¥ì„±**: ìƒˆë¡œìš´ ë¦¬ì†ŒìŠ¤/ì•¡ì…˜ ì‰½ê²Œ ì¶”ê°€ ê°€ëŠ¥

---

## 4. ì‹¤ì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ë³´ì•ˆ ì‚¬ê³  ì¡°ì‚¬
```bash
# íŠ¹ì • ì‚¬ìš©ìì˜ ì‚­ì œ ì‘ì—… ì¡°íšŒ
search_pattern = "audit-oms:*:*:delete:*:*"
grep "user-123" audit_logs | grep "delete"

# íŠ¹ì • ì‹œê°„ëŒ€ ì˜ì‹¬ í™œë™ ì¡°íšŒ
search_pattern = "audit-oms:*:*:*:20250626T02*:*"  # ìƒˆë²½ 2ì‹œëŒ€
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ê¶Œí•œ ê²€í† 
```python
# ì‚¬ìš©ìì˜ ì‹¤ì œ ê¶Œí•œê³¼ í• ë‹¹ëœ ì—­í•  ê²€ì¦
user_scopes = ["api:ontologies:write", "api:schemas:read"]
assigned_role = Role.DEVELOPER

is_valid, issues = ScopeRoleMatrix.validate_role_scope_assignment(
    assigned_role, user_scopes
)
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì´ìƒ íƒì§€
```python
# íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ë¹„ì •ìƒì ì¸ ì ‘ê·¼ íŒ¨í„´
audit_id = "audit-oms:object_type:sensitive_data:read:20250626T030000Z:uuid"
anomaly_keys = AuditIDGenerator.get_anomaly_detection_keys(audit_id)
# ìƒˆë²½ 3ì‹œì— ë¯¼ê°í•œ ë°ì´í„° ì ‘ê·¼ - ì´ìƒ íŒ¨í„´ìœ¼ë¡œ í”Œë˜ê·¸
```

---

## 5. í–¥í›„ í™•ì¥ ê³„íš

### ë‹¨ê¸° (1-2ì£¼)
1. **ë¡œê·¸ ì§‘ê³„ ëŒ€ì‹œë³´ë“œ**: Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì¶•
2. **ì•Œë¦¼ ì‹œìŠ¤í…œ**: ê³ ìœ„í—˜ íŒ¨í„´ ìë™ ì•Œë¦¼
3. **ì„±ëŠ¥ ìµœì í™”**: ì¸ë±ì‹± ì „ëµ ìˆ˜ë¦½

### ì¤‘ê¸° (1-2ê°œì›”)
1. **ML ê¸°ë°˜ ì´ìƒ íƒì§€**: ì‚¬ìš©ì í–‰ë™ íŒ¨í„´ í•™ìŠµ
2. **ìë™ ê¶Œí•œ ì¶”ì²œ**: ì‚¬ìš© íŒ¨í„´ ê¸°ë°˜ ê¶Œí•œ ìµœì í™”
3. **ì»´í”Œë¼ì´ì–¸ìŠ¤ ë¦¬í¬íŠ¸**: ìë™í™”ëœ ê°ì‚¬ ë³´ê³ ì„œ

### ì¥ê¸° (3-6ê°œì›”)
1. **ì˜ˆì¸¡ ë¶„ì„**: ë³´ì•ˆ ìœ„í—˜ ì˜ˆì¸¡ ëª¨ë¸
2. **ë™ì  ê¶Œí•œ ì¡°ì •**: ì‹¤ì‹œê°„ ê¶Œí•œ ì¡°ì •
3. **ì—°í•© ê°ì‚¬**: ë‹¤ì¤‘ ì„œë¹„ìŠ¤ í†µí•© ê°ì‚¬

---

## 6. ê²°ë¡ 

êµ¬ì¡°í™”ëœ Audit IDì™€ ì²´ê³„ì ì¸ Scope-Role ë§¤í•‘ì„ í†µí•´ OMSì˜ ê°ì‚¬ ë° ê¶Œí•œ ì‹œìŠ¤í…œì´ ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œë˜ì—ˆìŠµë‹ˆë‹¤.

**ì£¼ìš” ì´ì :**
- ğŸ” **ë¹ ë¥¸ ê²€ìƒ‰**: êµ¬ì¡°í™”ëœ IDë¡œ ì¦‰ì‹œ ë¡œê·¸ ê²€ìƒ‰
- ğŸ“Š **íŒ¨í„´ ë¶„ì„**: ìë™í™”ëœ ì´ìƒ íƒì§€ ë° íŠ¸ë Œë“œ ë¶„ì„  
- ğŸ” **ëª…í™•í•œ ê¶Œí•œ**: Scope-Role ë§¤í•‘ìœ¼ë¡œ ê¶Œí•œ íˆ¬ëª…ì„±
- ğŸ“ˆ **í™•ì¥ì„±**: ìƒˆë¡œìš´ ë¦¬ì†ŒìŠ¤/ê¶Œí•œ ì‰½ê²Œ ì¶”ê°€
- âœ… **ì»´í”Œë¼ì´ì–¸ìŠ¤**: ê°ì‚¬ ìš”êµ¬ì‚¬í•­ ì™„ë²½ ì¶©ì¡±

ì´ì œ OMSëŠ” ëŒ€ê·œëª¨ ì—”í„°í”„ë¼ì´ì¦ˆ í™˜ê²½ì—ì„œë„ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ìš´ì˜í•  ìˆ˜ ìˆëŠ” ê¸°ë°˜ì„ ê°–ì¶”ì—ˆìŠµë‹ˆë‹¤.

---

*êµ¬í˜„ ì™„ë£Œ: 2025-06-26*  
*ê²€í† ì: Claude Code*