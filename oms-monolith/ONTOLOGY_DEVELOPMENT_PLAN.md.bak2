# OMS Ontology Development Plan 

> **Scope Reminder**
> OMS (Ontology Metadata Service) *declares and versions the ontology metaâ€‘model only*.
> Runtime concerns (object instance storage, graph traversal, permission evaluation, state propagation) are implemented by sibling services â€” **Object Storage**, **Object Set Service**, **Action Service**, and **Vertex**.
> This plan therefore focuses *exclusively* on **metadata definition, validation, and contract generation**.
**Always check what code already exists in the codebase**
---

## 100â€¯% Compliance with *Ontology\_Requirements\_Document.md*

*Path: `/Users/sihyun/Desktop/ARRAKIS/SPICE/oms-monolith/Ontology_Requirements_Document.md`*

### Overview

The roadmap is organised into phases with clear milestones and tracking mechanisms. Existing wellâ€‘written sections were **retained verbatim**; only scopeâ€‘corrections were applied.

### Current Status Summary

| Category                | Implemented                                                                                                         | Pending                      |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------- | ---------------------------- |
| **Core Types**          | Object Type, Property, Shared Property, Link Type, Action Type, Interface, Data Type, Semantic Type, Struct Type   |                              |
| **Metadata Extensions** | Link Meta Flags (permissionInheritance, statePropagation, traversalMetadata), Graph Metadata Generator             |                              |
| **API Generation**      | Basic CRUD schemas, Semantic/Struct Type endpoints, GraphQL/OpenAPI schema generation with auto link fields       | âœ… Phase 5 Complete         |

> **Removed from OMS scope**: *Graph Index & Traversal*, *Runtime Permission Engine*, *Resolver Implementations*, *1â€¯B+ instance load tests*.  These items are now tracked in the **ObjectÂ Set / Action Service** backlogs.

---

## PhaseÂ 1 Â· Semantic Type Implementation (WeekÂ 1â€‘2)

**Goal**Â Â Implement the SemanticÂ (Value) Type system with domain constraints.

**Tasks**

1. **Create Semantic Type Model** `models/semantic_types.py`
   â€“ Define `SemanticType` with regex / minâ€‘max / enum validators
   â€“ Add registry & ADRâ€‘006 (Semantic Type Strategy)
2. **Property Integration**
   â€“ Reference semantic types in `Property`
   â€“ Validation hooks in **ValidationService**
   â€“ CRUD + GraphQL endpoints
   â€“ Preâ€‘defined types: `Email`, `URL`, `Phone`, `Currency`, etc.
3. **Testing & Docs**
   â€“ Unit + integration tests
   â€“ API docs update (OpenAPI & GraphQL)

**Deliverables**
`/models/semantic_types.py`, `/api/v1/semantic_types/*`, `/tests/test_semantic_types.py`

---

## PhaseÂ 2 Â· Struct Type Implementation (WeekÂ 3â€‘4)

**Goal**Â Â Support multiâ€‘field value aggregation (nonâ€‘nested).

**Key Rule**Â Â *Nested Structs are not supported* (Foundry constraint). Return explicit error.

**Tasks**

1. `models/struct_types.py` â€“ `StructType` with field map
2. Property enhancements + serializer
3. CRUD endpoints & GraphQL schema
4. Fallback validation for nesting violation

**Deliverables**
`/models/struct_types.py`, `/api/v1/struct_types/*`, `/core/schema/struct_validator.py`

---

## PhaseÂ 3 Â· **Link Meta Extensions** (WeekÂ 5â€‘6)

*Formerly â€œGraph Index & Traversalâ€ â€” now limited to metadata flags*

**Goal**Â Â Capture traversalâ€‘related semantics *without implementing traversal logic*.

**Tasks**

1. **LinkType Flags**
   â€“ `transitiveClosure: bool`
   â€“ `cascadeDepth: int` (â©½Â 5)
   â€“ `symmetric: bool`
2. **Validation Rules**
   â€“ Consistency checks (e.g., symmetric â‡’ bidirectional)
3. **Manifest Export**
   â€“ Generate JSON manifest consumed by **ObjectÂ Set Service** for index building

**Deliverables**
`/models/domain.py` (LinkType update), `/core/manifest/link_meta_exporter.py`

---

## PhaseÂ 4 Â· **Propagation Rule Metadata** (WeekÂ 7â€‘8)

*Runtime engine lives in Action Service; OMS only stores rules & publishes manifests.*

**Goal**Â Â Model permission & state inheritance policies.

**Tasks**

1. **LinkType Enhancements**
   â€“ `permissionInheritance: "none"|"parent"|"custom"`
   â€“ `statePropagation: "none"|"forward"|"reverse"|"both"`
2. **Rule Manifest Generator**
   â€“ Produce dictionary file â†’ pushed to ActionÂ Service
   â€“ Webhook for hotâ€‘reload
3. **Security Metadata Tests**

**Deliverables**
`/core/security/rule_manifest.py`, unit tests, updated ADRâ€‘007 (Propagation Semantics)

---

## PhaseÂ 5 Â· Enhanced API Schema Generation (WeekÂ 9â€‘10)  âœ… COMPLETE

**Goal**Â Â Autoâ€‘generate GraphQL/OpenAPI schemas *only*; resolvers are external.

**Completed Tasks**

1. âœ… **Schema Generator** `core/api/schema_generator.py`
   â€“ Produce `SingleLink` / `LinkSet` field types
   â€“ Emit SDL + OpenAPI documents
   â€“ Automatic link field generation for forward and reverse references
   â€“ HAL-style REST API with _links and _embedded
2. â³ **SDK Types** (Pending)
   â€“ Update Python & TypeScript SDK models

**Deliverables**
- âœ… GraphQL Schema Generator with automatic link fields
- âœ… OpenAPI 3.0 Schema Generator with HAL-style links
- âœ… API endpoints for schema generation (/api/v1/schema-generation/*)
- âœ… Comprehensive unit tests (17 test cases for edge cases and error handling)
- âœ… Integration tests for reverse references
- â³ Updated SDK packages (pending)

---

## PhaseÂ 6 Â· Metadata Performance & Merge Testing (WeekÂ 11â€‘12)
  ğŸš§ IN PROGRESS
**Goal**Â Â Validate OMS nonâ€‘functional requirements specific to metadata.

**Tasks**

1. âœ… **Branch & Merge DAG Stress** - Test environment prepared
   â€“ 10â€¯k concurrent branches
   â€“ 100â€¯k merge operations
   â€“ Diff generation <Â 200â€¯ms (P95)
2. **Schema CRUD Latency** <Â 50â€¯ms
3. **Audit Trail Verification**
   â€“ Ensure appendâ€‘only log, immutability proofs

**Deliverables**
Performance reports, optimisation patches, updated CI benchmarks

---

## Tracking & Governance

*Unchanged* â€” weekly status, RTM table, Git branch strategy, CI/CD quality gates remain identical except for removed crossâ€‘service items.  Requirements formerly labelled **GFâ€‘02/03/04** are reâ€‘tagged **OSâ€‘GFâ€‘xx** (ObjectÂ Set) or **ASâ€‘GFâ€‘xx** (Action Service) and referenced externally.

---

## Risk Mitigation (Updated)

| Risk                                     | Mitigation                                        |
| ---------------------------------------- | ------------------------------------------------- |
| **Branch DAG explosion**                 | Incremental mergeâ€‘queue, DAG compaction algorithm |
| **Semantic/Struct type overâ€‘validation** | Start minimal, release toggles per ADRâ€‘006/007    |
| **Backward compatibility**               | Schema evolution policy, deprecation warnings     |

*â€œTerminusDB query performance for 1â€¯B+ instancesâ€ moved to ObjectÂ Storage plan.*

---

## Success Criteria

* All metadata requirements âœ… complete
* Test coverage â‰¥â€¯95â€¯% (metadata code)
* Branch merge P95 <â€¯200â€¯ms
* Documentation & ADRs upâ€‘toâ€‘date
* External services successfully consume OMS manifests

---

## Next Steps

1. Approve revised scope & phase names
2. Create feature branches (`feature/semantic-types`, â€¦)
3. Begin PhaseÂ 1 implementation

**Plan Approved By**Â \_\_\_\_\_\_\_\_\_\_\_\_\_â€ƒâ€ƒ**Date**Â \_\_\_\_\_\_\_\_\_\_\_\_\_â€ƒâ€ƒ**Target Completion**Â +12Â weeks


---

## Requirement Traceability Matrix (Updated)

| Requirement ID | Status | Implementation File | Test File | Notes |
|----------------|--------|-------------------|-----------|-------|
| FR-OT-CRUD | âœ… Complete | /core/schema/service.py | /tests/test_schema.py | |
| FR-PR-META | âœ… Complete | /models/domain.py | /tests/test_property.py | |
| FR-SH-REUSE | âœ… Complete | /models/domain.py | /tests/test_shared_property.py | |
| FR-LK-DEF | âœ… Complete | /models/domain.py | /tests/test_link_type.py | |
| FR-LK-IDX | âœ… Complete | /core/graph/metadata_generator.py | /tests/test_graph_metadata.py | Metadata only |
| FR-AC-TRX | âœ… Complete | /core/action/service.py | /tests/test_action.py | |
| FR-AC-HIST | âœ… Complete | /core/events/service.py | /tests/test_audit.py | |
| FR-IF-POLY | âœ… Complete | /models/domain.py | /tests/test_interface.py | |
| FR-DT-CONST | âœ… Complete | /models/data_types.py | /tests/test_data_types.py | |
| FR-SM-VALID | âœ… Complete | /models/semantic_types.py | /tests/test_semantic_types.py | Phase 1 |
| FR-ST-STRUCT | âœ… Complete | /models/struct_types.py | /tests/test_struct_types.py | Phase 2 |
| FR-GR-PERM | âœ… Complete | /core/graph/metadata_generator.py | /tests/test_graph_metadata.py | Phase 3-4 |
| GF-02 | âœ… Complete | /core/graph/metadata_generator.py | /tests/test_graph_metadata.py | Index metadata |
| GF-03 | âœ… Complete | /models/domain.py, /core/graph/metadata_generator.py | /tests/test_graph_metadata.py | Propagation rules |
| API-GEN-01 | âœ… Complete | /core/api/schema_generator.py | /tests/test_schema_generator.py | Phase 5 - GraphQL/OpenAPI generation |
| API-GEN-02 | âœ… Complete | /api/v1/schema_generation/endpoints.py | /tests/test_schema_generation_api.py | Phase 5 - API endpoints |
